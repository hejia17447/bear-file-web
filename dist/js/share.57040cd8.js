(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["share"],{"0cb2":function(e,t,i){var r=i("7b0b"),a=Math.floor,l="".replace,s=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,n=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,i,o,c,u){var h=i+e.length,d=o.length,f=n;return void 0!==c&&(c=r(c),f=s),l.call(u,f,function(r,l){var s;switch(l.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,i);case"'":return t.slice(h);case"<":s=c[l.slice(1,-1)];break;default:var n=+l;if(0===n)return r;if(n>d){var u=a(n/10);return 0===u?r:u<=d?void 0===o[u-1]?l.charAt(1):o[u-1]+l.charAt(1):r}s=o[n-1]}return void 0===s?"":s})}},"19d9":function(e,t,i){"use strict";i("1f8f")},"1f8f":function(e,t,i){},"2d39":function(e,t,i){},"49ea":function(e,t,i){"use strict";i("7b79")},5319:function(e,t,i){"use strict";var r=i("d784"),a=i("d039"),l=i("825a"),s=i("1626"),n=i("5926"),o=i("50c4"),c=i("577e"),u=i("1d80"),h=i("8aa5"),d=i("dc4a"),f=i("0cb2"),p=i("14c3"),m=i("b622"),b=m("replace"),v=Math.max,g=Math.min,y=function(e){return void 0===e?e:String(e)},S=function(){return"$0"==="a".replace(/./,"$0")}(),w=function(){return!!/./[b]&&""===/./[b]("a","$0")}(),T=!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")});r("replace",function(e,t,i){var r=w?"$":"$0";return[function(e,i){var r=u(this),a=void 0==e?void 0:d(e,b);return a?a.call(e,r,i):t.call(c(r),e,i)},function(e,a){var u=l(this),d=c(e);if("string"===typeof a&&-1===a.indexOf(r)&&-1===a.indexOf("$<")){var m=i(t,u,d,a);if(m.done)return m.value}var b=s(a);b||(a=c(a));var S=u.global;if(S){var w=u.unicode;u.lastIndex=0}var T=[];while(1){var $=p(u,d);if(null===$)break;if(T.push($),!S)break;var F=c($[0]);""===F&&(u.lastIndex=h(d,o(u.lastIndex),w))}for(var C="",k=0,x=0;x<T.length;x++){$=T[x];for(var _=c($[0]),P=v(g(n($.index),d.length),0),B=[],N=1;N<$.length;N++)B.push(y($[N]));var L=$.groups;if(b){var I=[_].concat(B,P,d);void 0!==L&&I.push(L);var q=c(a.apply(void 0,I))}else q=f(_,d,P,B,L,a);P>=k&&(C+=d.slice(k,P)+q,k=P+_.length)}return C+d.slice(k)}]},!T||!S||w)},"7b79":function(e,t,i){},8315:function(e,t,i){"use strict";i("2d39")},"8a79":function(e,t,i){"use strict";var r=i("23e7"),a=i("06cf").f,l=i("50c4"),s=i("577e"),n=i("5a34"),o=i("1d80"),c=i("ab13"),u=i("c430"),h="".endsWith,d=Math.min,f=c("endsWith"),p=!u&&!f&&!!function(){var e=a(String.prototype,"endsWith");return e&&!e.writable}();r({target:"String",proto:!0,forced:!p&&!f},{endsWith:function(e){var t=s(o(this));n(e);var i=arguments.length>1?arguments[1]:void 0,r=t.length,a=void 0===i?r:d(l(i),r),c=s(e);return h?h.call(t,c,a):t.slice(a-c.length,a)===c}})},9326:function(e,t,i){"use strict";var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"file-table-wrapper"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"file-table",class:["file-type-"+e.fileType,"Share"===e.routeName?"share":""],attrs:{fit:"","element-loading-text":"文件加载中……","tooltip-effect":"dark",data:e.fileList,"highlight-current-row":!0},on:{"selection-change":e.handleSelectRow,"sort-change":e.handleSortChange,"row-contextmenu":e.handleContextMenu}},[8!==e.fileType?i("el-table-column",{key:"selection",attrs:{type:"selection",width:"56",align:"center"}}):e._e(),i("el-table-column",{key:"isDir",attrs:{label:"",prop:"isDir",width:e.screenWidth<=768?40:56,align:"center","class-name":"file-icon-column"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$file.isVideoFile(t.row)?i("video",{staticStyle:{width:"30px","max-height":"30px",cursor:"pointer"},attrs:{src:e.$file.setFileImg(t.row)}}):i("img",{staticStyle:{width:"30px","max-height":"30px",cursor:"pointer"},attrs:{src:e.$file.setFileImg(t.row),title:t.row.isDir?"":"点击预览"},on:{click:function(i){return e.$file.handleFileNameClick(t.row,t.$index,e.sortedFileList)}}})]}}])}),i("el-table-column",{key:"fileName",attrs:{prop:"fileName","sort-by":["isDir","fileName"],sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{on:{click:function(i){return e.$file.handleFileNameClick(t.row,t.$index,e.sortedFileList)}}},[i("span",{staticClass:"file-name",staticStyle:{cursor:"pointer"},attrs:{title:t.row.isDir?"":"点击预览"},domProps:{innerHTML:e._s(e.$file.getFileNameComplete(t.row,!0))}}),e.screenWidth<=768?i("div",{staticClass:"file-info"},[e._v(" "+e._s(t.row.uploadTime)+" "),i("span",{staticClass:"file-size"},[e._v(" "+e._s(0===t.row.isDir?e.$file.calculateFileSize(t.row.fileSize):"")+" ")])]):e._e()])]}}])},[i("template",{slot:"header"},[i("span",[e._v("文件名")])])],2),![0,8].includes(Number(e.$route.query.fileType))&&"Share"!==e.routeName&&e.screenWidth>768?i("el-table-column",{key:"filePath",attrs:{label:6===e.fileType?"原路径":"路径",prop:"filePath","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticStyle:{cursor:"pointer"},attrs:{title:"点击跳转"},on:{click:function(i){return e.$router.push({query:{filePath:t.row.filePath,fileType:0}})}}},[e._v(e._s(t.row.filePath))])]}}],null,!1,1587135183)}):e._e(),e.selectedColumnList.includes("extendName")&&e.screenWidth>768?i("el-table-column",{key:"extendName",attrs:{label:"类型",width:"80",prop:"extendName","sort-by":["isDir","extendName"],sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.$file.getFileType(t.row)))])]}}],null,!1,2003600077)}):e._e(),e.selectedColumnList.includes("fileSize")&&e.screenWidth>768?i("el-table-column",{key:"fileSize",attrs:{label:"大小",width:"100",prop:"fileSize","sort-by":["isDir","fileSize"],sortable:"",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(0===t.row.isDir?e.$file.calculateFileSize(t.row.fileSize):"")+" ")]}}],null,!1,3828750137)}):e._e(),e.selectedColumnList.includes("uploadTime")&&![7,8].includes(e.fileType)&&!["Share"].includes(this.routeName)&&e.screenWidth>768?i("el-table-column",{key:"uploadTime",attrs:{label:"修改日期",prop:"uploadTime",width:"160","sort-by":["isDir","uploadTime"],sortable:"",align:"center"}}):e._e(),6===e.fileType&&e.selectedColumnList.includes("deleteTime")&&e.screenWidth>768?i("el-table-column",{key:"deleteTime",attrs:{label:"删除日期",prop:"deleteTime",width:"160","sort-by":["isDir","deleteTime"],sortable:"",align:"center"}}):e._e(),8===e.fileType&&e.screenWidth>768?i("el-table-column",{key:"shareType",attrs:{label:"分享类型",prop:"shareType",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.shareType?"私密":"公共")+" ")]}}],null,!1,1274152603)}):e._e(),8===e.fileType&&e.screenWidth>768?i("el-table-column",{key:"shareTime",attrs:{label:"分享时间",prop:"shareTime",width:"160","sort-by":["isDir","shareTime"],"show-overflow-tooltip":"",sortable:"",align:"center"}}):e._e(),8===e.fileType&&e.screenWidth>768?i("el-table-column",{key:"endTime",attrs:{label:"过期时间",prop:"endTime",width:"190","sort-by":["isDir","endTime"],"show-overflow-tooltip":"",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[e.$file.getFileShareStatus(t.row.endTime)?i("i",{staticClass:"el-icon-warning"}):i("i",{staticClass:"el-icon-time"}),e._v(" "+e._s(t.row.endTime)+" ")])]}}],null,!1,1426114434)}):e._e(),e.screenWidth<=768?i("el-table-column",{key:"operation",attrs:{label:"",width:"48"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"file-operate el-icon-more",class:"operate-more-"+t.$index,on:{click:function(i){return e.handleClickMore(t.row,i)}}})]}}],null,!1,4078593407)}):e._e()],1)],1)},a=[],l=i("5530"),s=(i("a9e3"),i("b0c0"),i("2f62")),n={name:"FileTable",props:{fileType:{required:!0,type:Number},filePath:{required:!0,type:String},fileList:{required:!0,type:Array},loading:{required:!0,type:Boolean}},data:function(){return{officeFileType:["ppt","pptx","doc","docx","xls","xlsx"],sortedFileList:[]}},computed:Object(l["a"])(Object(l["a"])({},Object(s["b"])(["selectedColumnList"])),{},{routeName:function(){return this.$route.name},screenWidth:function(){return this.$store.state.common.screenWidth}}),watch:{filePath:function(){this.clearSelectedTable(),this.$refs.multipleTable.clearSort()},fileType:function(){this.clearSelectedTable(),this.$refs.multipleTable.clearSort()},fileList:function(){this.clearSelectedTable(),this.$refs.multipleTable.clearSort(),this.sortedFileList=this.fileList}},methods:{handleSortChange:function(){this.sortedFileList=this.$refs.multipleTable.tableData},handleContextMenu:function(e,t,i){var r=this;i.cancelBubble=!0,this.screenWidth>768&&(i.preventDefault(),this.$refs.multipleTable.setCurrentRow(e),this.$openBox.contextMenu({selectedFile:e,domEvent:i}).then(function(e){r.$refs.multipleTable.setCurrentRow(),"confirm"===e&&(r.$emit("getTableDataByType"),r.$store.dispatch("showStorage"))}))},clearSelectedTable:function(){this.$refs.multipleTable.clearSelection()},handleSelectRow:function(e){this.$store.commit("changeSelectedFiles",e),this.$store.commit("changeIsBatchOperation",0!==e.length)},handleClickMore:function(e,t){var i=this;this.$refs.multipleTable.setCurrentRow(e),this.$openBox.contextMenu({selectedFile:e,domEvent:t}).then(function(e){i.$refs.multipleTable.setCurrentRow(),"confirm"===e&&(i.$emit("getTableDataByType"),i.$store.dispatch("showStorage"))})}}},o=n,c=(i("49ea"),i("2877")),u=Object(c["a"])(o,r,a,!1,null,"3b8e3df5",null);t["a"]=u.exports},fbd8:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"share-wrapper"},[3===e.shareStep?i("div",{staticClass:"share-file-wrapper"},[i("div",{staticClass:"operation-wrapper"},[i("BreadCrumb",{staticClass:"breadcrumb",attrs:{fileType:7}}),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isLogin,expression:"isLogin"}],attrs:{type:"primary",size:"mini",icon:"el-icon-takeaway-box"},on:{click:e.handleSaveBtnClick}},[e._v("保存到网盘")])],1),i("FileTable",{ref:"fileTableInstance",attrs:{fileType:7,filePath:e.filePath,fileList:e.fileList,loading:e.loading}})],1):e._e(),i("el-dialog",{attrs:{title:"文件分享",visible:e.dialogShareFile.visible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"500px"},on:{"update:visible":function(t){return e.$set(e.dialogShareFile,"visible",t)}}},[1===e.shareStep?i("div",{staticClass:"end-time"},[e._v("此分享链接已过期")]):e._e(),2===e.shareStep?i("el-form",{ref:"codeForm",staticClass:"extraction-code-form",attrs:{model:e.dialogShareFile.codeForm,rules:e.dialogShareFile.codeFormRules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"提取码",prop:"extractionCode"}},[i("el-input",{model:{value:e.dialogShareFile.codeForm.extractionCode,callback:function(t){e.$set(e.dialogShareFile.codeForm,"extractionCode",t)},expression:"dialogShareFile.codeForm.extractionCode"}})],1)],1):e._e(),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1===e.shareStep?i("el-button",{on:{click:function(t){return e.handleCloseBtnClick()}}},[e._v("关 闭")]):i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmitBtnClick("codeForm")}}},[e._v("提 交")])],1)],1)],1)},a=[],l=i("5530"),s=(i("ac1f"),i("5319"),i("d81d"),i("fd26")),n=i("9326"),o=i("2f62"),c=i("60fb"),u={name:"Share",components:{BreadCrumb:s["a"],FileTable:n["a"]},data:function(){return{dialogShareFile:{visible:!1,codeForm:{extractionCode:""},codeFormRules:{extractionCode:[{required:!0,message:"请输入提取码",trigger:"blur"}]}},shareStep:0,fileList:[],loading:!1}},computed:Object(l["a"])(Object(l["a"])({},Object(o["b"])(["isLogin"])),{},{shareBatchNum:function(){return this.$route.params.shareBatchNum},filePath:function(){return this.$route.query.filePath},shareFilePath:function(){return this.$route.query.filePath},selectedFiles:function(){return this.$store.state.fileList.selectedFiles}}),watch:{filePath:function(){this.getShareList()}},created:function(){this.filePath||this.$router.replace({query:{filePath:"/"}})},mounted:function(){this.checkEndTime()},methods:{checkEndTime:function(){var e=this;Object(c["e"])({shareBatchNum:this.shareBatchNum}).then(function(t){t.success?"true"===localStorage.getItem("qiwen_share_".concat(e.shareBatchNum))?e.checkShareComplete():(e.dialogShareFile.visible=!0,e.checkShareType()):(e.dialogShareFile.visible=!0,e.shareStep=1)})},checkShareType:function(){var e=this;Object(c["f"])({shareBatchNum:this.shareBatchNum}).then(function(t){t.success?(0===t.data.shareType&&(e.shareStep=3,e.getShareList(),e.dialogShareFile.visible=!1),1===t.data.shareType&&(e.shareStep=2)):e.$message.error(t.message)})},handleCloseBtnClick:function(){this.dialogShareFile.visible=!1,this.$router.push({name:"File",query:{fileType:0,filePath:"/"}})},handleSubmitBtnClick:function(e){var t=this;this.$refs[e].validate(function(i){if(!i)return!1;Object(c["d"])({extractionCode:t.dialogShareFile.codeForm.extractionCode,shareBatchNum:t.shareBatchNum}).then(function(i){i.success?(localStorage.setItem("qiwen_share_".concat(t.shareBatchNum),!0),t.$refs[e].resetFields(),t.checkShareComplete()):t.$message.error(i.message)})})},checkShareComplete:function(){this.shareStep=3,this.dialogShareFile.visible=!1,this.getShareList()},getShareList:function(){var e=this;this.loading=!0,Object(c["r"])({shareFilePath:this.shareFilePath,shareBatchNum:this.shareBatchNum}).then(function(t){t.success?(e.fileList=t.dataList,e.loading=!1):e.$message.error(t.message)})},handleSaveBtnClick:function(){var e=this;this.selectedFiles.length?this.$openDialog.saveShareFile({filePath:"",fileInfo:this.selectedFiles.map(function(e){return{userFileId:e.userFileId}})}).then(function(){e.$refs.fileTableInstance.clearSelectedTable()}):this.$message.warning("请先勾选要保存的文件")}}},h=u,d=(i("8315"),i("2877")),f=Object(d["a"])(h,r,a,!1,null,"4ec950e6",null);t["default"]=f.exports},fd26:function(e,t,i){"use strict";var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"breadcrumb-wrapper"},[i("div",{staticClass:"title"},[e._v("当前位置：")]),i("el-input",{directives:[{name:"show",rawName:"v-show",value:e.isShowInput,expression:"isShowInput"}],ref:"filePathInputRef",staticClass:"file-path-input",attrs:{placeholder:"请输入路径",size:"mini",autofocus:!0},on:{blur:e.handleInputBlurEnter,change:e.handleInputBlurEnter},model:{value:e.inputFilePath,callback:function(t){e.inputFilePath=t},expression:"inputFilePath"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowInput,expression:"!isShowInput"}],staticClass:"breadcrumb-box",class:{"able-input":0===e.fileType},on:{click:function(t){return t.target!==t.currentTarget?null:e.handleClickBreadCrumbSelf(t)}}},[[0,8].includes(e.fileType)||["Share"].includes(e.$route.name)?i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},e._l(e.breadCrumbList,function(t,r){return i("el-breadcrumb-item",{key:r,attrs:{to:e.getRouteQuery(t)}},[e._v(e._s(t.name))])}),1):i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",[e._v(e._s(e.fileTypeMap[e.fileType]))])],1)],1)],1)},a=[],l=(i("a9e3"),i("ac1f"),i("1276"),i("a15b"),i("b0c0"),i("8a79"),i("fb6a"),{name:"BreadCrumb",props:{fileType:{required:!0,type:Number},filePath:{require:!0,type:String}},data:function(){return{fileTypeMap:{1:"全部图片",2:"全部文档",3:"全部视频",4:"全部音乐",5:"其他",6:"回收站"},isShowInput:!1,inputFilePath:""}},computed:{breadCrumbList:{get:function(){for(var e=this.$route.query.filePath,t=e?e.split("/"):[],i=[],r=[],a=0;a<t.length;a++)t[a]?(r.push(t[a]),i.push({path:r.join("/"),name:t[a]})):0===a&&(t[a]="",r.push(t[a]),i.push({path:"/",name:0===this.fileType?"全部文件":8===this.fileType?"我的分享":"Share"===this.$route.name?"全部分享":""}));return i},set:function(){return[]}}},methods:{handleClickBreadCrumbSelf:function(){var e=this;0===this.fileType&&(this.inputFilePath=this.filePath,this.isShowInput=!0,this.$nextTick(function(){e.$refs.filePathInputRef.focus()}))},handleInputBlurEnter:function(){if(this.isShowInput=!1,this.inputFilePath!==this.filePath){var e=this.inputFilePath.endsWith("/")?this.inputFilePath.slice(0,-1):this.inputFilePath;this.$router.push({query:{filePath:"".concat(e),fileType:0}})}},getRouteQuery:function(e){var t=this.$route.name;return"Share"===t?{query:{filePath:e.path}}:8===this.fileType?{query:{fileType:8,filePath:e.path,shareBatchNum:"/"===e.path?void 0:this.$route.query.shareBatchNum}}:{query:{filePath:e.path,fileType:0}}}}}),s=l,n=(i("19d9"),i("2877")),o=Object(n["a"])(s,r,a,!1,null,"5d20e2e2",null);t["a"]=o.exports}}]);